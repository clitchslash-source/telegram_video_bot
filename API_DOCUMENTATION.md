# Telegram Video Generator Bot - API Documentation

## –û–±–∑–æ—Ä API

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ API endpoints –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

## Telegram Webhook API

### –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram

**Endpoint:** `POST /api/telegram/webhook`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram (—Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫)

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "update_id": 123456789,
  "message": {
    "message_id": 1,
    "from": {
      "id": 987654321,
      "is_bot": false,
      "first_name": "John",
      "username": "johndoe",
      "last_name": "Doe"
    },
    "chat": {
      "id": 987654321,
      "type": "private",
      "first_name": "John"
    },
    "date": 1699999999,
    "text": "/start"
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

**Endpoint:** `POST /api/telegram/payment-webhook`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç –Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å–∞

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "event": "payment.succeeded",
  "object": {
    "id": "payment_id_12345",
    "status": "succeeded",
    "amount": {
      "value": "500.00",
      "currency": "RUB"
    },
    "metadata": {
      "telegramId": "987654321",
      "tokens": 500
    }
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true
}
```

## –ö–æ–º–∞–Ω–¥—ã Telegram –±–æ—Ç–∞

### /start

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–æ—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 60 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å Notion

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, John!

–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

ü™ô –í–∞–º –≤—ã–¥–∞–Ω–æ 60 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤!

–°—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
üé¨ –í–∏–¥–µ–æ 10 —Å–µ–∫: 20 —Ç–æ–∫–µ–Ω–æ–≤
üé¨ –í–∏–¥–µ–æ 15 —Å–µ–∫: 25 —Ç–æ–∫–µ–Ω–æ–≤
üé® –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞: 10 —Ç–æ–∫–µ–Ω–æ–≤
```

### /balance

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /balance
–ë–æ—Ç: üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: 60 —Ç–æ–∫–µ–Ω–æ–≤

üé¨ –í–∏–¥–µ–æ 10 —Å–µ–∫: 20 —Ç–æ–∫–µ–Ω–æ–≤
üé¨ –í–∏–¥–µ–æ 15 —Å–µ–∫: 25 —Ç–æ–∫–µ–Ω–æ–≤
üé® –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞: 10 —Ç–æ–∫–µ–Ω–æ–≤
```

### /buy

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é –ø–æ–∫—É–ø–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /buy
–ë–æ—Ç: üí≥ –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤:

[üí≥ 500 —Ç–æ–∫–µ–Ω–æ–≤ (500 —Ä—É–±)]
[üí≥ 1000 —Ç–æ–∫–µ–Ω–æ–≤ (1000 —Ä—É–±)]
[üí≥ 2000 —Ç–æ–∫–µ–Ω–æ–≤ (2000 —Ä—É–±)]
[üí≥ 4000 —Ç–æ–∫–µ–Ω–æ–≤ (4000 —Ä—É–±)]
```

### /help

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

**–ü—Ä–∏–º–µ—Ä:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /help
–ë–æ—Ç: ‚öôÔ∏è –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:

/start - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
/balance - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å
/buy - –ö—É–ø–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
/history - –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

–ö–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ:
1. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç (–ø—Ä–æ–º–ø—Ç)
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –≥–æ–ª–æ—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ
4. –í–∏–¥–µ–æ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ
```

## –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ (–ø—Ä–æ–º–ø—Ç–∞)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ö—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –º–æ—Ä–µ–º —Å —á–∞–π–∫–∞–º–∏
–ë–æ—Ç: üé• –í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ:

[üé¨ 10 —Å–µ–∫ (20 —Ç–æ–∫–µ–Ω–æ–≤)]
[üé¨ 15 —Å–µ–∫ (25 —Ç–æ–∫–µ–Ω–æ–≤)]
```

### 2. –í—ã–±–æ—Ä –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ù–∞–∂–∏–º–∞–µ—Ç "10 —Å–µ–∫"]
–ë–æ—Ç: üé• –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ:

[üîπ –ù–∏–∑–∫–æ–µ]
[üî∏ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ]
[üî∫ –í—ã—Å–æ–∫–æ–µ]
```

### 3. –í—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ù–∞–∂–∏–º–∞–µ—Ç "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ"]
–ë–æ—Ç: ‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–∏–¥–µ–æ... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.
```

### 4. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```
–ë–æ—Ç: ‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!

üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: 40 —Ç–æ–∫–µ–Ω–æ–≤

‚¨áÔ∏è [–°–∫–∞—á–∞—Ç—å –≤–∏–¥–µ–æ]
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ü—ã—Ç–∞–µ—Ç—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ]
–ë–æ—Ç: ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤!

–¢—Ä–µ–±—É–µ—Ç—Å—è: 20 —Ç–æ–∫–µ–Ω–æ–≤
–í–∞—à –±–∞–ª–∞–Ω—Å: 10 —Ç–æ–∫–µ–Ω–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /buy –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤.
```

### –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

```
–ë–æ—Ç: ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ:

API error: Service temporarily unavailable

–¢–æ–∫–µ–Ω—ã –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –Ω–∞ –≤–∞—à —Å—á–µ—Ç.
```

### –û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞

```
–ë–æ—Ç: ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (TelegramUser)

```typescript
{
  id: number;
  telegramId: string;
  username?: string;
  firstName: string;
  lastName?: string;
  tokenBalance: number;
  totalTokensPurchased: number;
  totalTokensSpent: number;
  totalGenerations: number;
  isActive: boolean;
  lastInteractionAt: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (VideoGeneration)

```typescript
{
  id: number;
  telegramId: string;
  inputType: "text" | "image" | "voice";
  duration: "10" | "15";
  quality: string;
  prompt?: string;
  inputFileUrl?: string;
  outputVideoUrl?: string;
  tokensCost: number;
  hasWatermark: boolean;
  watermarkRemovalApplied: boolean;
  watermarkRemovalCost: number;
  status: "pending" | "processing" | "completed" | "failed";
  errorMessage?: string;
  kieAiJobId?: string;
  createdAt: Date;
  completedAt?: Date;
  updatedAt: Date;
}
```

### –ü–ª–∞—Ç–µ–∂ (PaymentTransaction)

```typescript
{
  id: number;
  telegramId: string;
  paymentId: string;
  amount: string;
  tokens: number;
  status: "pending" | "succeeded" | "failed" | "cancelled";
  paymentMethod?: string;
  description?: string;
  notionSynced: boolean;
  createdAt: Date;
  completedAt?: Date;
  updatedAt: Date;
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### KIE.AI API

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ:**
```
POST https://api.kie.ai/v1/video/generate
Authorization: Bearer {KIE_AI_API_KEY}

{
  "prompt": "–ö—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –º–æ—Ä–µ–º",
  "duration": 10,
  "quality": "standard",
  "removeWatermark": false
}
```

**–£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞:**
```
POST https://api.kie.ai/v1/video/remove-watermark
Authorization: Bearer {KIE_AI_API_KEY}

{
  "videoUrl": "https://example.com/video.mp4"
}
```

### –Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å–∞ API

**–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:**
```
POST https://api.yookassa.ru/v3/payments
Authorization: Basic {base64(SHOP_ID:SECRET_KEY)}

{
  "amount": {
    "value": "500.00",
    "currency": "RUB"
  },
  "confirmation": {
    "type": "redirect",
    "return_url": "https://t.me/your_bot"
  },
  "metadata": {
    "telegramId": "987654321",
    "tokens": 500
  }
}
```

### Notion API

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```
POST https://api.notion.com/v1/pages
Authorization: Bearer {NOTION_API_KEY}

{
  "parent": {
    "database_id": "{NOTION_DATABASE_ID}"
  },
  "properties": {
    "Telegram ID": {
      "title": [{"text": {"content": "987654321"}}]
    },
    "Current Balance": {
      "number": 60
    },
    "Total Purchased": {
      "number": 0
    }
  }
}
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ API
2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ API –∫–ª—é—á–∏
5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

## –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = await getTelegramUser(telegramId);
console.log(`–ë–∞–ª–∞–Ω—Å: ${user.tokenBalance} —Ç–æ–∫–µ–Ω–æ–≤`);

// –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ
const generation = await createVideoGeneration({
  telegramId,
  inputType: "text",
  duration: "10",
  quality: "standard",
  prompt: "–ö—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç",
  tokensCost: 20,
  status: "pending",
});

// –°–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
await deductTokensFromUser(telegramId, 20);

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Notion
await notionClient.syncUserToNotion({
  telegramId,
  currentBalance: user.tokenBalance - 20,
  totalTokensSpent: user.totalTokensSpent + 20,
});
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.
