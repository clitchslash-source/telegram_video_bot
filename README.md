# Telegram Video Generator Bot üé¨

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram –±–æ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ KIE.AI —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–∫–µ–Ω–æ–≤, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö —Å Notion.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ** –∏–∑ —Ç–µ–∫—Å—Ç–∞, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≥–æ–ª–æ—Å–∞
- **–°–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤** —Å –ø–æ–∫—É–ø–∫–æ–π –ø–∞–∫–µ—Ç–æ–≤ (500, 1000, 2000, 4000 —Ä—É–±)
- **–ü–ª–∞—Ç–µ–∂–∏** —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å–∞
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** –≤ Notion (—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)
- **–£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–í—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞** –≤–∏–¥–µ–æ (–Ω–∏–∑–∫–æ–µ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ, –≤—ã—Å–æ–∫–æ–µ)
- **–í—ã–±–æ—Ä –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –≤–∏–¥–µ–æ (10 –∏–ª–∏ 15 —Å–µ–∫—É–Ω–¥)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã** –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (60 —Ç–æ–∫–µ–Ω–æ–≤)

## üìä –°–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω

| –£—Å–ª—É–≥–∞ | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|-----------|
| –í–∏–¥–µ–æ 10 —Å–µ–∫ | 20 —Ç–æ–∫–µ–Ω–æ–≤ |
| –í–∏–¥–µ–æ 15 —Å–µ–∫ | 25 —Ç–æ–∫–µ–Ω–æ–≤ |
| –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ | 10 —Ç–æ–∫–µ–Ω–æ–≤ |
| –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ | 60 —Ç–æ–∫–µ–Ω–æ–≤ |

## üí≥ –ü–∞–∫–µ—Ç—ã –ø–æ–∫—É–ø–∫–∏

| –°—É–º–º–∞ | –¢–æ–∫–µ–Ω—ã |
|-------|--------|
| 500 —Ä—É–± | 500 —Ç–æ–∫–µ–Ω–æ–≤ |
| 1000 —Ä—É–± | 1000 —Ç–æ–∫–µ–Ω–æ–≤ |
| 2000 —Ä—É–± | 2000 —Ç–æ–∫–µ–Ω–æ–≤ |
| 4000 —Ä—É–± | 4000 —Ç–æ–∫–µ–Ω–æ–≤ |

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend**: Node.js + Express + tRPC
- **Database**: MySQL/TiDB —Å Drizzle ORM
- **Frontend**: React 19 + Tailwind CSS (–¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏)
- **Video Generation**: KIE.AI API
- **Payments**: Yandex.Kassa API
- **Analytics**: Notion API
- **Bot**: Telegram Bot API

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram_video_bot/
‚îú‚îÄ‚îÄ client/                          # React –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ _core/                      # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ db.ts                       # –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ routers.ts                  # tRPC —Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegramWebhook.ts      # Webhook endpoints
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ telegramBotClient.ts    # Telegram API –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ kieAiClient.ts          # KIE.AI API –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ yandexKassaClient.ts    # Yandex.Kassa –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ notionClient.ts         # Notion API –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îî‚îÄ‚îÄ botHandlers.ts          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ drizzle/                        # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ shared/                         # –û–±—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îú‚îÄ‚îÄ scripts/                        # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ QUICK_START.md                  # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îú‚îÄ‚îÄ DEPLOYMENT.md                   # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ WEBHOOK_SETUP.md                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook
‚îú‚îÄ‚îÄ API_DOCUMENTATION.md            # API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ TELEGRAM_BOT_SETUP.md          # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –±–æ—Ç—É
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
git clone <your-repo-url> telegram_video_bot
cd telegram_video_bot

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ Management UI:

- `TELEGRAM_BOT_TOKEN`
- `KIE_AI_API_KEY`
- `YANDEX_KASSA_SHOP_ID`
- `YANDEX_KASSA_SECRET_KEY`
- `NOTION_API_KEY`
- `NOTION_DATABASE_ID`
- `DATABASE_URL`

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö:
```bash
node scripts/verify-env.mjs
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

```bash
pnpm db:push
```

### 4. –ó–∞–ø—É—Å–∫

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
pnpm dev

# Production
pnpm build
pnpm start
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[QUICK_START.md](./QUICK_START.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
- **[DEPLOYMENT.md](./DEPLOYMENT.md)** - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production
- **[WEBHOOK_SETUP.md](./WEBHOOK_SETUP.md)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram webhook
- **[API_DOCUMENTATION.md](./API_DOCUMENTATION.md)** - –ü–æ–ª–Ω–∞—è API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **[TELEGRAM_BOT_SETUP.md](./TELEGRAM_BOT_SETUP.md)** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –±–æ—Ç—É

## ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã (–≤—ã–¥–∞–µ—Ç 60 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤) |
| `/balance` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤ |
| `/buy` | –ö—É–ø–∏—Ç—å —Ç–æ–∫–µ–Ω—ã |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

## üì± –ü—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç 60 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ –∏–ª–∏ –≥–æ–ª–æ—Å ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
3. –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è ‚Üí —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è
4. –¢–æ–∫–µ–Ω—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è ‚Üí –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
5. –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å Notion

## üîå API Endpoints

### Telegram Webhook
- `POST /api/telegram/webhook` - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram
- `POST /api/telegram/payment-webhook` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π

### tRPC API
- `/api/trpc/*` - –í—Å–µ tRPC –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

1. **telegram_users** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
2. **token_transactions** - –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–æ–∫–µ–Ω–∞–º–∏
3. **video_generations** - –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤–∏–¥–µ–æ
4. **payment_transactions** - –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
5. **notion_sync_status** - –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Notion

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ HTTPS –¥–ª—è –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ API –∫–ª—é—á–∏ –≤ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π webhook
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å Notion –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
- –ö—É–ø–ª–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ—Ç—Ä–∞—á–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
node scripts/verify-env.mjs
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```bash
pnpm dev
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
```bash
mysql -h {host} -u {user} -p {database} -e "SELECT * FROM telegram_users;"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook
```bash
curl https://api.telegram.org/bot{TOKEN}/getWebhookInfo
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É

1. –°–æ–∑–¥–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `server/services/botHandlers.ts`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `server/routes/telegramWebhook.ts`
3. –î–æ–±–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `telegramBotClient.ts`

### –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—ã

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `shared/config.ts`:

```typescript
export const TOKEN_PRICING = {
  VIDEO_10_SEC: 20,
  VIDEO_15_SEC: 25,
  WATERMARK_REMOVAL: 10,
  FREE_TOKENS_ON_START: 60,
};
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤

```typescript
export const PAYMENT_PACKAGES = [
  { rubles: 500, tokens: 500, displayName: "500 —Ç–æ–∫–µ–Ω–æ–≤" },
  // –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç –∑–¥–µ—Å—å
];
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ production —Å–µ—Ä–≤–µ—Ä —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ [DEPLOYMENT.md](./DEPLOYMENT.md).

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `pnpm dev`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `node scripts/verify-env.mjs`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å webhook: `curl https://api.telegram.org/bot{TOKEN}/getWebhookInfo`

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [KIE.AI Documentation](https://kie.ai/docs)
- [Yandex.Kassa API](https://yookassa.ru/developers)
- [Notion API](https://developers.notion.com/)

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –≤–∏–¥–µ–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ Telegram**
